#ifndef SX127X_H_
#define SX127X_H_

#include "contiki.h"
#include "dev/radio.h"
#include "dev/spi.h"
#include "sx1272-api.h"

#ifdef SX127X_SPI_SCK_PORT_CONF
#define SX127X_SPI_SCK_PORT SX127X_SPI_SCK_PORT_CONF
#else
#define SX127X_SPI_SCK_PORT SPI1_CLK_PORT
#endif
#ifdef SX127X_SPI_MISO_PORT_CONF
#define SX127X_SPI_MISO_PORT SX127X_SPI_MISO_PORT_CONF
#else
#define SX127X_SPI_MISO_PORT SPI1_RX_PORT
#endif
#ifdef SX127X_SPI_MOSI_PORT_CONF
#define SX127X_SPI_MOSI_PORT SX127X_SPI_MOSI_PORT_CONF
#else
#define SX127X_SPI_MOSI_PORT SPI1_TX_PORT
#endif

#ifdef SX127X_SPI_CS_PORT_CONF
#define SX127X_SPI_CS_PORT SX127X_SPI_CS_PORT_CONF
#else
#define SX127X_SPI_CS_PORT GPIO_B_NUM
#endif

#ifdef SX127X_SPI_SCK_CONF
#define SX127X_SPI_SCK SX127X_SPI_SCK_CONF
#else
#define SX127X_SPI_SCK SPI1_CLK_PIN
#endif

#ifdef SX127X_SPI_MISO_CONF
#define SX127X_SPI_MISO SX127X_SPI_MISO_CONF
#else
#define SX127X_SPI_MISO SPI1_RX_PIN
#endif

#ifdef SX127X_SPI_MOSI_CONF
#define SX127X_SPI_MOSI SX127X_SPI_MOSI_CONF
#else
#define SX127X_SPI_MOSI SPI1_TX_PIN
#endif

#ifdef SX127X_SPI_CS_CONF
#define SX127X_SPI_CS SX127X_SPI_CS_CONF
#else
#define SX127X_SPI_CS 6
#endif

#ifdef SX127X_SPI_BITRATE_CONF
#define SX127X_SPI_BITRATE SX127X_SPI_BITRATE_CONF
#else
#define SX127X_SPI_BITRATE 8000000
#endif

#ifdef SX127X_SPI_PHASE_CONF
#define SX127X_SPI_PHASE SX127X_SPI_PHASE_CONF
#else
#define SX127X_SPI_PHASE 0
#endif

#ifdef SX127X_SPI_POL_CONF
#define SX127X_SPI_POL SX127X_SPI_POL_CONF
#else
#define SX127X_SPI_POL 0
#endif

#ifdef SX127X_SPI_CONTROLLER_CONF
#define SX127X_SPI_CONTROLLER SX127X_SPI_CONTROLLER_CONF
#else
#define SX127X_SPI_CONTROLLER 0
#endif

#ifdef SX127X_RESET_GPIO_PORT_CONF
#define SX127X_RESET_GPIO_PORT SX127X_RESEST_GPIO_PORT_CONF
#else
#define SX127X_RESET_GPIO_PORT GPIO_A_NUM
#endif

#ifdef SX127X_RESET_GPIO_CONF
#define SX127X_RESET_GPIO SX127X_RESEST_GPIO_CONF
#else
#define SX127X_RESET_GPIO 5 // CC1200_SPI_CSN_PIN
#endif

#ifdef SX127X_DIO0_PORT_CONF
#define SX127X_DIO0_PORT SX127X_DIO0_PORT_CONF
#else
#define SX127X_DIO0_PORT GPIO_B_NUM
#endif

#ifdef SX127X_DIO0_PIN_CONF 
#define SX127X_DIO0_PIN SX127X_DIO0_PIN_CONF 
#else
#define SX127X_DIO0_PIN 4
#endif

#ifdef SX127X_DIO3_PORT_CONF
#define SX127X_DIO3_PORT SX127X_DIO3_PORT_CONF
#else
#define SX127X_DIO3_PORT GPIO_B_NUM
#endif

#ifdef SX127X_DIO3_PIN_CONF 
#define SX127X_DIO3_PIN SX127X_DIO3_PIN_CONF 
#else
#define SX127X_DIO3_PIN 0
#endif

#ifdef SX127X_CONF_BUSY_RX
#define SX127X_BUSY_RX SX127X_CONF_BUSY_RX
#else
#ifndef MAC_CONF_WITH_CSMA
#define SX127X_BUSY_RX 1
#else
#define SX127X_BUSY_RX 0
#endif
#endif

#if defined(SX127X_DIO0_PORT) && defined(SX127X_DIO0_PIN) && defined(SX127X_DIO3_PORT) && defined(SX127X_DIO3_PIN)
#define SX127X_USE_INTERRUPT 1
#else
#define SX127X_USE_INTERRUPT 0
#endif

#ifdef SX127X_LORA_INIT_SF_CONF
#define SX127X_LORA_INIT_SF SX127X_LORA_INIT_SF_CONF
#else 
#define SX127X_LORA_INIT_SF RADIO_SF_7
#endif

#ifdef SX127X_LORA_INIT_BW_CONF
#define SX127X_LORA_INIT_BW SX127X_LORA_INIT_BW_CONF
#else 
#define SX127X_LORA_INIT_BW RADIO_BW_125
#endif

#ifdef SX127X_LORA_INIT_CR_CONF
#define SX127X_LORA_INIT_CR SX127X_LORA_INIT_CR_CONF
#else 
#define SX127X_LORA_INIT_CR RADIO_CR_4_5
#endif

#ifdef SX127X_LORA_INIT_PRLEN_CONF
#define SX127X_LORA_INIT_PRLEN SX127X_LORA_INIT_PRLEN_CONF
#else 
#define SX127X_LORA_INIT_PRLEN 8
#endif

#ifdef SX127X_LORA_INIT_CRC_CONF
#define SX127X_LORA_INIT_CRC SX127X_LORA_INIT_CRC_CONF
#else 
#define SX127X_LORA_INIT_CRC true
#endif

#ifdef SX127X_LORA_INIT_IMPLICIT_HEADER_CONF
#define SX127X_LORA_INIT_IMPLICIT_HEADER SX127X_LORA_INIT_IMPLICIT_HEADER_CONF
#else 
#define SX127X_LORA_INIT_IMPLICIT_HEADER false
#endif

#define SX127X_TSCH_DEFAULT_TS_MAX_TX (LORA_T_PACKET(SX127X_LORA_INIT_SF, SX127X_LORA_INIT_BW, SX127X_LORA_INIT_CRC, SX127X_LORA_INIT_IMPLICIT_HEADER, SX127X_LORA_INIT_CR, SX127X_LORA_INIT_PRLEN, 256))

#define SX127X_TSCH_DEFAULT_TS_CCA_OFFSET 0
#define SX127X_TSCH_DEFAULT_TS_CCA 0
#define SX127X_TSCH_DEFAULT_TS_TX_OFFSET 2500
#define SX127X_TSCH_DEFAULT_TS_RX_OFFSET (SX127X_TSCH_DEFAULT_TS_TX_OFFSET - (TSCH_CONF_RX_WAIT / 2))
#define SX127X_TSCH_DEFAULT_TS_TX_ACK_DELAY 7500
#define SX127X_TSCH_DEFAULT_TS_RX_ACK_DELAY (SX127X_TSCH_DEFAULT_TS_TX_ACK_DELAY - (TSCH_CONF_RX_WAIT / 2))
#define SX127X_TSCH_DEFAULT_TS_RX_WAIT 5000
#define SX127X_TSCH_DEFAULT_TS_ACK_WAIT 5000 // TSCH_CONF_RX_WAIT
#define SX127X_TSCH_DEFAULT_TS_RX_TX 0
#define SX127X_TSCH_DEFAULT_TS_MAX_ACK (LORA_T_PACKET(SX127X_LORA_INIT_SF, SX127X_LORA_INIT_BW, SX127X_LORA_INIT_CRC, SX127X_LORA_INIT_IMPLICIT_HEADER, SX127X_LORA_INIT_CR, SX127X_LORA_INIT_PRLEN, 40))
#define SX127X_TSCH_DEFAULT_TS_TIMESLOT_LENGTH ( SX127X_TSCH_DEFAULT_TS_TX_OFFSET \
        + SX127X_TSCH_DEFAULT_TS_MAX_TX \
        + SX127X_TSCH_DEFAULT_TS_TX_ACK_DELAY \
        + SX127X_TSCH_DEFAULT_TS_MAX_ACK )

extern semtech_dev_t __sx127x_dev;

#ifdef SX127X_DEV_CONF
#define SX127X_DEV SX127X_DEV_CONF
#else
#define SX127X_DEV __sx127x_dev
#endif 

extern semtech_dev_t __sx127x_dev;
extern const struct radio_driver sx127x_radio_driver;
#endif
